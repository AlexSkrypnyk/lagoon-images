- name: create new branch
  command: git checkout -b {{ branch }}
  args:
    chdir: /{{git_repo_name}}

- name: copying {{git_files}} into git repo
  copy:
    src: /ansible/files/{{git_files}}
    dest: /{{git_repo_name}}/

- name: adding all files to git repo
  command: git add .
  args:
    chdir: /{{git_repo_name}}

- name: commiting in git repo
  command: git commit -m "push"
  args:
    chdir: /{{git_repo_name}}

- name: getting current git branch
  command: git symbolic-ref --short HEAD
  args:
    chdir: /{{git_repo_name}}
  register: gitbranch

- set_fact:
    current_branch: "{{ gitbranch.stdout }}"

- name: fore push to repo in {{ gitbranch.stdout }}
  command: git push --force origin {{ gitbranch.stdout }}
  args:
    chdir: /{{git_repo_name}}

- name: getting HEAD hash
  command: git rev-parse HEAD
  args:
    chdir: /{{git_repo_name}}
  register: result

- set_fact:
    current_head: "{{ result.stdout }}"

- debug:
    msg: "Head Hash: {{ current_head }}"