- name: "{{ testname }} - make sure we are on the branch {{ branch }}"
  shell: git checkout -b {{ branch }} || git checkout {{ branch }}
  args:
    chdir: /{{git_repo_name}}

#This is where we need to move the .lagoon.yml.test over the .lagoon.yml file
- name: "{{ testname }} - replace .lagoon.yml file to remove cronjob for testing"
  command: mv .lagoon.yml.test .lagoon.yml
  args:
    chdir: /{{git_repo_name}}

- name: "{{ testname }} - commit changed .lagoon.yml to {{git_repo_name}}"
  command: git commit -am "Removing cronjob"
  args:
    chdir: /{{git_repo_name}}

- name: "{{ testname }} - getting current head git hash in repo {{git_repo_name}}"
  command: git rev-parse HEAD
  args:
    chdir: /{{git_repo_name}}
  register: result

- name: "{{ testname }} - getting current gitbranch in repo {{git_repo_name}}"
  command: git symbolic-ref --short HEAD
  args:
    chdir: /{{git_repo_name}}
  register: gitbranch

- name: "{{ testname }} - force push branch {{ branch }} to remote in git repo {{git_repo_name}}"
  command: git push --force origin {{ gitbranch.stdout }}
  args:
    chdir: /{{git_repo_name}}

- set_fact:
    current_head: "{{ result.stdout }}"

- debug:
    msg: "{{ testname }} - current head git hash: {{ current_head }}"